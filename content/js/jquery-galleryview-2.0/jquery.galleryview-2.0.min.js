var window_loaded=false;(function(a){a.fn.galleryView=function(y){var D=a.extend(a.fn.galleryView.defaults,y);var K;var t=0;var j=0;var F;var B;var S=false;var q;var N;var x;var J;var v;var e;var s;var c;var z;var A=20;var o;var G;var g;var k=new Object();var Q=new Object();var U=new Object();var P=new Object();var l=true;var b=false;var C;var M;var V;var I;var O;var T;function u(X){a(".nav-next-overlay",C).unbind("click");a(".nav-prev-overlay",C).unbind("click");a(".nav-next",C).unbind("click");a(".nav-prev",C).unbind("click");V.unbind("click");if(D.show_filmstrip){V.removeClass("current").find("img").stop().animate({opacity:D.frame_opacity},D.transition_speed);V.eq(X).addClass("current").find("img").stop().animate({opacity:1},D.transition_speed)}if(D.show_panels&&D.fade_panels){O.fadeOut(D.transition_speed).eq(X%j).fadeIn(D.transition_speed,function(){if(!D.show_filmstrip){a(".nav-prev-overlay",C).click(R);a(".nav-next-overlay",C).click(f);a(".nav-prev",C).click(R);a(".nav-next",C).click(f)}})}if(D.show_filmstrip){if(F=="strip"){M.stop();if(g=="horizontal"){var Z=w(V[X]).left-(w(T[0]).left+(J/2)-(c/2));var W=(Z>=0?"-=":"+=")+Math.abs(Z)+"px";M.animate({left:W},D.transition_speed,D.easing,function(){var aa=X;if(X>j){X=X%j;t=X;M.css("left","-"+((c+D.frame_gap)*X)+"px")}else{if(X<=(j-strip_size)){X=(X%j)+j;t=X;M.css("left","-"+((c+D.frame_gap)*X)+"px")}}if(aa!=X){V.eq(aa).removeClass("current").find("img").css({opacity:D.frame_opacity});V.eq(X).addClass("current").find("img").css({opacity:1})}if(!D.fade_panels){O.hide().eq(X%j).show()}a(".nav-prev-overlay",C).click(R);a(".nav-next-overlay",C).click(f);a(".nav-prev",C).click(R);a(".nav-next",C).click(f);L()})}else{var Z=w(V[X]).top-(w(T[0]).top+(x)-(z/2));var W=(Z>=0?"-=":"+=")+Math.abs(Z)+"px";M.animate({top:W},D.transition_speed,D.easing,function(){var aa=X;if(X>j){X=X%j;t=X;M.css("top","-"+((z+D.frame_gap)*X)+"px")}else{if(X<=(j-strip_size)){X=(X%j)+j;t=X;M.css("top","-"+((z+D.frame_gap)*X)+"px")}}if(aa!=X){V.eq(aa).removeClass("current").find("img").css({opacity:D.frame_opacity});V.eq(X).addClass("current").find("img").css({opacity:1})}if(!D.fade_panels){O.hide().eq(X%j).show()}a(".nav-prev-overlay",C).click(R);a(".nav-next-overlay",C).click(f);a(".nav-prev",C).click(R);a(".nav-next",C).click(f);L()})}}else{if(F=="pointer"){T.stop();var Y=w(V[X]);if(g=="horizontal"){T.animate({left:(Y.left+(c/2)-(J/2)+"px")},D.transition_speed,D.easing,function(){if(!D.fade_panels){O.hide().eq(X%j).show()}a(".nav-prev-overlay",C).click(R);a(".nav-next-overlay",C).click(f);a(".nav-prev",C).click(R);a(".nav-next",C).click(f);L()})}else{T.animate({top:(Y.top+(z/2)-(x)+"px")},D.transition_speed,D.easing,function(){if(!D.fade_panels){O.hide().eq(X%j).show()}a(".nav-prev-overlay",C).click(R);a(".nav-next-overlay",C).click(f);a(".nav-prev",C).click(R);a(".nav-next",C).click(f);L()})}}}}}function n(X){if(!X){return 0}if(X.length==0){return 0}X=X.eq(0);var W=0;W+=E(X.css("paddingLeft"));W+=E(X.css("paddingRight"));W+=E(X.css("borderLeftWidth"));W+=E(X.css("borderRightWidth"));return W}function h(W){if(!W){return 0}if(W.length==0){return 0}W=W.eq(0);var X=0;X+=E(W.css("paddingTop"));X+=E(W.css("paddingBottom"));X+=E(W.css("borderTopWidth"));X+=E(W.css("borderBottomWidth"));return X}function f(){a(document).stopTime("transition");if(++t==V.length){t=0}u(t);if(!S){a(document).everyTime(D.transition_interval,"transition",function(){f()})}}function R(){a(document).stopTime("transition");if(--t<0){t=j-1}u(t);if(!S){a(document).everyTime(D.transition_interval,"transition",function(){f()})}}function w(Z){var ac=0,ab=0;var W=Z.id;if(Z.offsetParent){do{ac+=Z.offsetLeft;ab+=Z.offsetTop}while(Z=Z.offsetParent)}if(W==K){return{left:ac,top:ab}}else{var Y=w(C[0]);var aa=Y.left;var X=Y.top;return{left:ac-aa,top:ab-X}}}function L(){V.each(function(W){if(a("a",this).length==0){a(this).click(function(){if(t!=W){a(document).stopTime("transition");u(W);t=W;if(!S){a(document).everyTime(D.transition_interval,"transition",function(){f()})}}})}})}function m(){O.each(function(W){if(a(".panel-overlay",this).length>0){a(this).append('<div class="overlay-background"></div>')}});if(!D.show_filmstrip){a("<img />").addClass("nav-next").attr("src",B+D.nav_theme+"/next.gif").appendTo(C).css({position:"absolute",zIndex:"1100",cursor:"pointer",top:((D.panel_height-22)/2)+o+"px",right:"10px",display:"none"}).click(f);a("<img />").addClass("nav-prev").attr("src",B+D.nav_theme+"/prev.gif").appendTo(C).css({position:"absolute",zIndex:"1100",cursor:"pointer",top:((D.panel_height-22)/2)+o+"px",left:"10px",display:"none"}).click(R);a("<img />").addClass("nav-next-overlay").attr("src",B+D.nav_theme+"/panel-nav-next.gif").appendTo(C).css({position:"absolute",zIndex:"1099",top:((D.panel_height-22)/2)+o-10+"px",right:"0",display:"none",cursor:"pointer",opacity:0.75}).click(f);a("<img />").addClass("nav-prev-overlay").attr("src",B+D.nav_theme+"/panel-nav-prev.gif").appendTo(C).css({position:"absolute",zIndex:"1099",top:((D.panel_height-22)/2)+o-10+"px",left:"0",display:"none",cursor:"pointer",opacity:0.75}).click(R)}O.each(function(W){a(this).css({width:(D.panel_width-n(O))+"px",height:(D.panel_height-h(O))+"px",position:"absolute",overflow:"hidden",display:"none"});switch(D.filmstrip_position){case"top":a(this).css({top:e+Math.max(o,G)+"px",left:o+"px"});break;case"left":a(this).css({top:o+"px",left:v+Math.max(o,G)+"px"});break;default:a(this).css({top:o+"px",left:o+"px"});break}});a(".panel-overlay",O).css({position:"absolute",zIndex:"999",width:(D.panel_width-n(a(".panel-overlay",O)))+"px",left:"0"});a(".overlay-background",O).css({position:"absolute",zIndex:"998",width:D.panel_width+"px",left:"0",opacity:D.overlay_opacity});if(D.overlay_position=="top"){a(".panel-overlay",O).css("top",0);a(".overlay-background",O).css("top",0)}else{a(".panel-overlay",O).css("bottom",0);a(".overlay-background",O).css("bottom",0)}a(".panel iframe",O).css({width:D.panel_width+"px",height:D.panel_height+"px",border:"0"});if(l){a("img",O).each(function(W){a(this).css({height:Q[W%j]*U[W%j],width:Q[W%j]*P[W%j],position:"relative",top:(D.panel_height-(Q[W%j]*U[W%j]))/2+"px",left:(D.panel_width-(Q[W%j]*P[W%j]))/2+"px"})})}}function d(){M.wrap('<div class="strip_wrapper"></div>');if(F=="strip"){V.clone().appendTo(M);V.clone().appendTo(M);V=a("li",M)}if(D.show_captions){V.append('<div class="caption"></div>').each(function(aa){a(this).find(".caption").html(a(this).find("img").attr("title"))})}M.css({listStyle:"none",margin:"0",padding:"0",width:v+"px",position:"absolute",zIndex:"900",top:(g=="vertical"&&F=="strip"?-((z+D.frame_gap)*t):0)+"px",left:(g=="horizontal"&&F=="strip"?-((c+D.frame_gap)*t):0)+"px",height:e+"px"});V.css({"float":"left",position:"relative",height:z+(D.show_captions?A:0)+"px",width:c+"px",zIndex:"901",padding:"0",cursor:"pointer"});switch(D.filmstrip_position){case"top":V.css({marginBottom:G+"px",marginRight:D.frame_gap+"px"});break;case"bottom":V.css({marginTop:G+"px",marginRight:D.frame_gap+"px"});break;case"left":V.css({marginRight:G+"px",marginBottom:D.frame_gap+"px"});break;case"right":V.css({marginLeft:G+"px",marginBottom:D.frame_gap+"px"});break}a(".img_wrap",V).each(function(aa){a(this).css({height:Math.min(D.frame_height,U[aa%j]*k[aa%j])+"px",width:Math.min(D.frame_width,P[aa%j]*k[aa%j])+"px",position:"relative",top:(D.show_captions&&D.filmstrip_position=="top"?A:0)+Math.max(0,(D.frame_height-(k[aa%j]*U[aa%j]))/2)+"px",left:Math.max(0,(D.frame_width-(k[aa%j]*P[aa%j]))/2)+"px",overflow:"hidden"})});a("img",V).each(function(aa){a(this).css({opacity:D.frame_opacity,height:U[aa%j]*k[aa%j]+"px",width:P[aa%j]*k[aa%j]+"px",position:"relative",top:Math.min(0,(D.frame_height-(k[aa%j]*U[aa%j]))/2)+"px",left:Math.min(0,(D.frame_width-(k[aa%j]*P[aa%j]))/2)+"px"}).mouseover(function(){a(this).stop().animate({opacity:1},300)}).mouseout(function(){if(!a(this).parent().parent().hasClass("current")){a(this).stop().animate({opacity:D.frame_opacity},300)}})});a(".strip_wrapper",C).css({position:"absolute",overflow:"hidden"});if(g=="horizontal"){a(".strip_wrapper",C).css({top:(D.filmstrip_position=="top"?Math.max(o,G)+"px":D.panel_height+o+"px"),left:((q-s)/2)+o+"px",width:s+"px",height:e+"px"})}else{a(".strip_wrapper",C).css({left:(D.filmstrip_position=="left"?Math.max(o,G)+"px":D.panel_width+o+"px"),top:Math.max(o,D.frame_gap)+"px",width:v+"px",height:wrapper_height+"px"})}a(".caption",C).css({position:"absolute",top:(D.filmstrip_position=="bottom"?z:0)+"px",left:"0",margin:"0",width:c+"px",padding:"0",height:A+"px",overflow:"hidden",lineHeight:A+"px"});var Z=a("<div></div>");Z.addClass("pointer").appendTo(C).css({position:"absolute",zIndex:"1000",width:"0px",fontSize:"0px",lineHeight:"0%",borderTopWidth:x+"px",borderRightWidth:(J/2)+"px",borderBottomWidth:x+"px",borderLeftWidth:(J/2)+"px",borderStyle:"solid"});var W=a.browser.msie&&a.browser.version.substr(0,1)=="6"?"pink":"transparent";if(!D.show_panels){Z.css("borderColor",W)}switch(D.filmstrip_position){case"top":Z.css({bottom:(D.panel_height-(x*2)+o+G)+"px",left:((q-s)/2)+(F=="strip"?0:((c+D.frame_gap)*t))+((c/2)-(J/2))+o+"px",borderBottomColor:W,borderRightColor:W,borderLeftColor:W});break;case"bottom":Z.css({top:(D.panel_height-(x*2)+o+G)+"px",left:((q-s)/2)+(F=="strip"?0:((c+D.frame_gap)*t))+((c/2)-(J/2))+o+"px",borderTopColor:W,borderRightColor:W,borderLeftColor:W});break;case"left":Z.css({right:(D.panel_width-J+o+G)+"px",top:(z/2)-(x)+(F=="strip"?0:((z+D.frame_gap)*t))+o+"px",borderBottomColor:W,borderRightColor:W,borderTopColor:W});break;case"right":Z.css({left:(D.panel_width-J+o+G)+"px",top:(z/2)-(x)+(F=="strip"?0:((z+D.frame_gap)*t))+o+"px",borderBottomColor:W,borderLeftColor:W,borderTopColor:W});break}T=a(".pointer",C);var X=a("<img />");X.addClass("nav-next").attr("src",B+D.nav_theme+"/next.gif").appendTo(C).css({position:"absolute",cursor:"pointer"}).click(f);var Y=a("<img />");Y.addClass("nav-prev").attr("src",B+D.nav_theme+"/prev.gif").appendTo(C).css({position:"absolute",cursor:"pointer"}).click(R);if(g=="horizontal"){X.css({top:(D.filmstrip_position=="top"?Math.max(o,G):D.panel_height+G+o)+((z-22)/2)+"px",right:((q+(o*2))/2)-(s/2)-D.frame_gap-22+"px"});Y.css({top:(D.filmstrip_position=="top"?Math.max(o,G):D.panel_height+G+o)+((z-22)/2)+"px",left:((q+(o*2))/2)-(s/2)-D.frame_gap-22+"px"})}else{X.css({left:(D.filmstrip_position=="left"?Math.max(o,G):D.panel_width+G+o)+((c-22)/2)+13+"px",top:wrapper_height+(Math.max(o,D.frame_gap)*2)+"px"});Y.css({left:(D.filmstrip_position=="left"?Math.max(o,G):D.panel_width+G+o)+((c-22)/2)-13+"px",top:wrapper_height+(Math.max(o,D.frame_gap)*2)+"px"})}}function H(W,aa){var Z=w(C[0]);var Y=Z.top;var X=Z.left;return W>X&&W<X+q+(g=="horizontal"?(o*2):o+Math.max(o,G))&&aa>Y&&aa<Y+N+(g=="vertical"?(o*2):o+Math.max(o,G))}function E(W){W=parseInt(W,10);if(isNaN(W)){W=0}return W}function r(){var W=D.show_filmstrip?a("img",V):a("img",O);W.each(function(X){U[X]=this.height;P[X]=this.width;if(D.frame_scale=="nocrop"){k[X]=Math.min(D.frame_height/U[X],D.frame_width/P[X])}else{k[X]=Math.max(D.frame_height/U[X],D.frame_width/P[X])}if(D.panel_scale=="nocrop"){Q[X]=Math.min(D.panel_height/U[X],D.panel_width/P[X])}else{Q[X]=Math.max(D.panel_height/U[X],D.panel_width/P[X])}});C.css({position:"relative",width:q+(g=="horizontal"?(o*2):o+Math.max(o,G))+"px",height:N+(g=="vertical"?(o*2):o+Math.max(o,G))+"px"});if(D.show_filmstrip){d();L()}if(D.show_panels){m()}if(D.pause_on_hover||(D.show_panels&&!D.show_filmstrip)){a().mousemove(function(X){if(H(X.pageX,X.pageY)){if(D.pause_on_hover){if(!S){a(document).oneTime(500,"animation_pause",function(){a(document).stopTime("transition");S=true})}}if(D.show_panels&&!D.show_filmstrip&&!b){a(".nav-next-overlay").fadeIn("fast");a(".nav-prev-overlay").fadeIn("fast");a(".nav-next",C).fadeIn("fast");a(".nav-prev",C).fadeIn("fast");b=true}}else{if(D.pause_on_hover){a(document).stopTime("animation_pause");if(S){a(document).everyTime(D.transition_interval,"transition",function(){f()});S=false}}if(D.show_panels&&!D.show_filmstrip&&b){a(".nav-next-overlay").fadeOut("fast");a(".nav-prev-overlay").fadeOut("fast");a(".nav-next",C).fadeOut("fast");a(".nav-prev",C).fadeOut("fast");b=false}}})}M.css("visibility","visible");C.css("visibility","visible");a(".loader",C).fadeOut("1000",function(){u(t);if(j>1){a(document).everyTime(D.transition_interval,"transition",function(){f()})}})}return this.each(function(){a(this).css("visibility","hidden");a(this).wrap("<div></div>");C=a(this).parent();C.css("visibility","hidden").attr("id",a(this).attr("id")).addClass("gallery");a(this).removeAttr("id").addClass("filmstrip");a(document).stopTime("transition");a(document).stopTime("animation_pause");K=C.attr("id");l=a(".panel-content",C).length==0;x=D.pointer_size;J=D.pointer_size*2;g=(D.filmstrip_position=="top"||D.filmstrip_position=="bottom"?"horizontal":"vertical");if(g=="vertical"){D.show_captions=false}a("script").each(function(W){var X=a(this);if(X.attr("src")&&X.attr("src").match(/jquery\.galleryview/)){loader_path=X.attr("src").split("jquery.galleryview")[0];B=X.attr("src").split("jquery.galleryview")[0]+"themes/"}});M=a(".filmstrip",C);V=a("li",M);V.addClass("frame");if(D.show_panels){for(i=V.length-1;i>=0;i--){if(V.eq(i).find(".panel-content").length>0){V.eq(i).find(".panel-content").remove().prependTo(C).addClass("panel")}else{p=a("<div>");p.addClass("panel");im=a("<img />");im.attr("src",V.eq(i).find("img").eq(0).attr("src")).appendTo(p);p.prependTo(C);V.eq(i).find(".panel-overlay").remove().appendTo(p)}}}else{a(".panel-overlay",V).remove();a(".panel-content",V).remove()}if(!D.show_filmstrip){M.remove()}else{V.each(function(W){if(a(this).find("a").length>0){a(this).find("a").wrap('<div class="img_wrap"></div>')}else{a(this).find("img").wrap('<div class="img_wrap"></div>')}});I=a(".img_wrap",V)}O=a(".panel",C);if(!D.show_panels){D.panel_height=0;D.panel_width=0}c=D.frame_width+n(I);z=D.frame_height+h(I);j=D.show_panels?O.length:V.length;if(g=="horizontal"){strip_size=D.show_panels?Math.floor((D.panel_width-((D.frame_gap+22)*2))/(c+D.frame_gap)):Math.min(j,D.filmstrip_size)}else{strip_size=D.show_panels?Math.floor((D.panel_height-(D.frame_gap+22))/(z+D.frame_gap)):Math.min(j,D.filmstrip_size)}if(strip_size>=j){F="pointer";strip_size=j}else{F="strip"}t=(strip_size<j?j:0)+D.start_frame-1;G=(D.show_panels?E(M.css("marginTop")):0);M.css("margin","0px");if(g=="horizontal"){q=D.show_panels?D.panel_width:(strip_size*(c+D.frame_gap))+44+D.frame_gap;N=(D.show_panels?D.panel_height:0)+(D.show_filmstrip?z+G+(D.show_captions?A:0):0)}else{N=D.show_panels?D.panel_height:(strip_size*(z+D.frame_gap))+22;q=(D.show_panels?D.panel_width:0)+(D.show_filmstrip?c+G:0)}if(g=="horizontal"){if(F=="pointer"){v=(c*j)+(D.frame_gap*(j))}else{v=(c*j*3)+(D.frame_gap*(j*3))}}else{v=(c+G)}if(g=="horizontal"){e=(z+G+(D.show_captions?A:0))}else{if(F=="pointer"){e=(z*j+D.frame_gap*(j))}else{e=(z*j*3)+(D.frame_gap*(j*3))}}s=((strip_size*c)+((strip_size-1)*D.frame_gap));wrapper_height=((strip_size*z)+((strip_size-1)*D.frame_gap));o=E(C.css("paddingTop"));C.css("padding","0px");galleryPos=w(C[0]);a("<div>").addClass("loader").css({position:"absolute",zIndex:"32666",opacity:1,top:"0px",left:"0px",width:q+(g=="horizontal"?(o*2):o+Math.max(o,G))+"px",height:N+(g=="vertical"?(o*2):o+Math.max(o,G))+"px"}).appendTo(C);if(!window_loaded){a(window).load(function(){window_loaded=true;r()})}else{r()}})};a.fn.galleryView.defaults={show_panels:true,show_filmstrip:true,panel_width:600,panel_height:400,frame_width:60,frame_height:40,start_frame:1,filmstrip_size:3,transition_speed:800,transition_interval:4000,overlay_opacity:0.7,frame_opacity:0.3,pointer_size:8,nav_theme:"dark",easing:"swing",filmstrip_position:"bottom",overlay_position:"bottom",panel_scale:"nocrop",frame_scale:"crop",frame_gap:5,show_captions:false,fade_panels:true,pause_on_hover:false}})(jQuery);